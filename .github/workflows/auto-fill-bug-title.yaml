name: Auto-fill Bug Title

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  update-issue-title:
    runs-on: ubuntu-latest
    steps:
      - name: Extract issue type and update title
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.issue.body || "";
            const rawTitle = context.payload.issue.title;

            console.log("Issue body:\n", body);

            // Match GitHub issue form dropdown rendering
            const match = /### issue_type\s+(.+?)\s*(###|$)/s.exec(body);

            if (!match) {
              console.log("ğŸš« issue_type not found in issue body.");
              return;
            }

            const issueType = match[1].trim();

            const typeMap = {
              "ğŸ“š Documentation Issue": "ğŸ“š",
              "ğŸ§  Conceptual Issue": "ğŸ§ ",
              "ğŸ’» Code Issue": "ğŸ’»",
              "â“ Unspecified": "â“"
            };

            const icon = typeMap[issueType] || "â“";

            // Avoid double-prefixing
            if (/^[ğŸ“šğŸ§ ğŸ’»â“]/.test(rawTitle)) {
              console.log("âœ… Title already has an emoji prefix.");
              return;
            }

            const issueNumber = context.issue.number;
            const newTitle = `${icon} [Bug]: ${rawTitle}`;

            console.log(`âœï¸ Updating title to: ${newTitle}`);

            await github.rest.issues.update({
              ...context.repo,
              issue_number: issueNumber,
              title: newTitle
            });
